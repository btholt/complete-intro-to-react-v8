{"pageProps":{"post":{"attributes":{"description":"","title":"RTK Query"},"html":"<p>Very similar to @tanstack/react-query that we saw in Complete Intro, there is a Redux Toolkit Query (always abbreviated as RTK Query). It works extremely similarly to react-query but with a Redux twist on it. If you&#39;re using Redux, I recommend you use RTK Query instead of react-query. Likewise I wouldn&#39;t introduce RTK to your app <em>just</em> to use RTK Query. Just know both are similar and are wonderful to work with.</p>\n<p>So we&#39;re going to replace all of our uses of react-query with RTK Query.</p>\n<p>Make a file called petApiService.js. In there put:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">import</span> { createApi, fetchBaseQuery } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@reduxjs/toolkit/query/react&quot;</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> petApi = <span class=\"hljs-title function_\">createApi</span>({\n  <span class=\"hljs-attr\">reducerPath</span>: <span class=\"hljs-string\">&quot;petApi&quot;</span>,\n  <span class=\"hljs-attr\">baseQuery</span>: <span class=\"hljs-title function_\">fetchBaseQuery</span>({ <span class=\"hljs-attr\">baseUrl</span>: <span class=\"hljs-string\">&quot;http://pets-v2.dev-apis.com&quot;</span> }),\n  <span class=\"hljs-attr\">endpoints</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">builder</span>) =&gt;</span> ({\n    <span class=\"hljs-attr\">getPet</span>: builder.<span class=\"hljs-title function_\">query</span>({\n      <span class=\"hljs-attr\">query</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">id</span>) =&gt;</span> ({ <span class=\"hljs-attr\">url</span>: <span class=\"hljs-string\">&quot;pets&quot;</span>, <span class=\"hljs-attr\">params</span>: { id } }),\n      <span class=\"hljs-attr\">transformResponse</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">response</span>) =&gt;</span> response.<span class=\"hljs-property\">pets</span>[<span class=\"hljs-number\">0</span>],\n    }),\n  }),\n});\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> { useGetPetQuery } = petApi;\n</code></pre>\n<ul>\n<li>With RTK query you build these services around base URLs. In our case, our API is all on the same path so it all works out well. You then build endpoints which have their own sort of URL builders.</li>\n<li>We built a getPet endpoint. It takes in an ID and then uses that as a URL query parameter. So with that with an ID of 4 the URL built would be the <code>baseUrl</code> + the endpoint <code>url</code> + the params so <a href=\"http://pets-v2.dev-apis.com/pets?id=4\">http://pets-v2.dev-apis.com/pets?id=4</a></li>\n<li><code>transformResponse</code> is so you can extract the actual part of the response you want to keep. We just want the first pet in the pets array so we nab that.</li>\n<li>Finally <code>createApi</code> will create a hook for you to use in your app so we&#39;re going to export that.</li>\n</ul>\n<p>Okay, let&#39;s go put it in store.js now</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">import</span> { petApi } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./petApiService&quot;</span>; <span class=\"hljs-comment\">// import service</span>\n\n<span class=\"hljs-keyword\">const</span> store = <span class=\"hljs-title function_\">configureStore</span>({\n  <span class=\"hljs-attr\">reducer</span>: {\n    adoptedPet,\n    searchParams,\n    [petApi.<span class=\"hljs-property\">reducerPath</span>]: petApi.<span class=\"hljs-property\">reducer</span>, <span class=\"hljs-comment\">// add reducer</span>\n  },\n  <span class=\"hljs-attr\">middleware</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">getDefaultMiddleware</span>) =&gt;</span>\n    <span class=\"hljs-title function_\">getDefaultMiddleware</span>().<span class=\"hljs-title function_\">concat</span>(petApi.<span class=\"hljs-property\">middleware</span>), <span class=\"hljs-comment\">// add middleware</span>\n});\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> store;\n</code></pre>\n<ul>\n<li>We need to add our reducer to our store. RTK query will cache our responses directly in our Redux store for us with its generated reducers but we do need to add it to our store</li>\n<li>The middleware isn&#39;t strictly necessary but it does allow for additional feature like caching, invalidation, refetching, etc. I just always add it. But your app with basic caching does work without the middleware.</li>\n</ul>\n<p>Okay! Now we&#39;re ready to use this in React! Let&#39;s head to Details.jsx</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// remove useQuery import</span>\n<span class=\"hljs-comment\">// remove fetchPet import</span>\n<span class=\"hljs-keyword\">import</span> { useGetPetQuery } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./petApiService&quot;</span>;\n\n<span class=\"hljs-comment\">// delete const results = useQuery([&quot;details&quot;, id], fetchPet);</span>\n\n<span class=\"hljs-keyword\">const</span> { isLoading, <span class=\"hljs-attr\">data</span>: pet } = <span class=\"hljs-title function_\">useGetPetQuery</span>(id);\n\n<span class=\"hljs-keyword\">if</span> (isLoading) { <span class=\"hljs-comment\">// remove results.</span>\n  […]\n}\n</code></pre>\n<p>And now it should work!! As you can see, very similar to react-query. Let&#39;s quickly do the other requests.</p>\n<p>Back in petApiService.js</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// add two endpoints</span>\n<span class=\"hljs-attr\">endpoints</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">builder</span>) =&gt;</span> ({\n  […]\n  <span class=\"hljs-attr\">getBreeds</span>: builder.<span class=\"hljs-title function_\">query</span>({\n    <span class=\"hljs-attr\">query</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">animal</span>) =&gt;</span> ({ <span class=\"hljs-attr\">url</span>: <span class=\"hljs-string\">&quot;breeds&quot;</span>, <span class=\"hljs-attr\">params</span>: { animal } }),\n    <span class=\"hljs-attr\">transformResponse</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">response</span>) =&gt;</span> response.<span class=\"hljs-property\">breeds</span>,\n  }),\n  <span class=\"hljs-attr\">search</span>: builder.<span class=\"hljs-title function_\">query</span>({\n    <span class=\"hljs-attr\">query</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">{ animal, location, breed }</span>) =&gt;</span> ({\n      <span class=\"hljs-attr\">url</span>: <span class=\"hljs-string\">&quot;pets&quot;</span>,\n      <span class=\"hljs-attr\">params</span>: { animal, location, breed },\n    }),\n    <span class=\"hljs-attr\">transformResponse</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">response</span>) =&gt;</span> response.<span class=\"hljs-property\">pets</span>,\n  }),\n}),\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> { useGetBreedsQuery, useGetPetQuery, useSearchQuery } = petApi; <span class=\"hljs-comment\">// add exports</span>\n</code></pre>\n<p>Now to useBreedList.js</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">import</span> { useGetBreedsQuery } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./petApiService&quot;</span>;\n\n<span class=\"hljs-comment\">// delete these two</span>\n<span class=\"hljs-comment\">// import { useQuery } from &quot;@tanstack/react-query&quot;;</span>\n<span class=\"hljs-comment\">// import fetchBreedList from &quot;./fetchBreedList&quot;;</span>\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">useBreedList</span>(<span class=\"hljs-params\">animal</span>) {\n  <span class=\"hljs-comment\">// delete this line</span>\n  <span class=\"hljs-comment\">// const results = useQuery([&quot;breeds&quot;, animal], fetchBreedList);</span>\n\n  <span class=\"hljs-keyword\">const</span> { <span class=\"hljs-attr\">data</span>: breeds, isLoading } = <span class=\"hljs-title function_\">useGetBreedsQuery</span>(animal, {\n    <span class=\"hljs-attr\">skip</span>: !animal,\n  });\n\n  <span class=\"hljs-keyword\">if</span> (!animal) {\n    <span class=\"hljs-keyword\">return</span> [[], <span class=\"hljs-string\">&quot;loaded&quot;</span>];\n  }\n\n  <span class=\"hljs-keyword\">return</span> [breeds ?? [], isLoading ? <span class=\"hljs-string\">&quot;loading&quot;</span> : <span class=\"hljs-string\">&quot;loaded&quot;</span>];\n}\n</code></pre>\n<ul>\n<li>Very close to what we had.</li>\n<li>We&#39;re telling the hook &quot;hey, if there&#39;s no animal, don&#39;t fetch. Give the user back an empty array&quot;</li>\n<li>I&#39;m being lazy with the isLoaded status. You could look at <code>isLoaded</code>, <code>isFetching</code>, <code>isError</code>, <code>isSuccess</code>, etc. and come up with a better system. We&#39;re not using it so I&#39;m not working too hard on it.</li>\n</ul>\n<p>Last one. Head to SearchParam.jsx</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// remove imports for fetchSearch and useQuery</span>\n<span class=\"hljs-keyword\">import</span> { useSearchQuery } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;./petApiService&quot;</span>;\n\n<span class=\"hljs-comment\">// replace useQuery call</span>\n<span class=\"hljs-keyword\">const</span> { <span class=\"hljs-attr\">data</span>: pets } = <span class=\"hljs-title function_\">useSearchQuery</span>(searchParams);\npets = pets ?? [];\n</code></pre>\n<p>That&#39;s it! Congrats! You&#39;re now using RTK query. Again, this is awesome if you&#39;re already in Redux land but I end up mostly using react-query because I don&#39;t use Redux as much these days.</p>\n","slug":"rtk-query","title":"RTK Query","section":"Redux","icon":"database","filePath":"/home/runner/work/complete-intro-to-react-v8/complete-intro-to-react-v8/lessons/14-redux/C-rtk-query.md","nextSlug":"/lessons/redux/redux-dev-tools","prevSlug":"/lessons/redux/more-app-state"}},"__N_SSG":true}