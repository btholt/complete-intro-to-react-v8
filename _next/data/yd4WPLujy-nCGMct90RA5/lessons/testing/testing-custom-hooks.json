{"pageProps":{"post":{"attributes":{"description":""},"html":"<p>Let&#39;s say we needs tests for our custom hook, useBreedList. Testing custom hooks is a bit of a trick because they are inherently tied to the internal workings of React: they can&#39;t be called outside of a component. So how we do we get around that? We fake a component! Make a file called useBreedList.test.jsx in our <code>__tests__</code> directory.</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">import</span> { expect, test } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;vitest&quot;</span>;\n<span class=\"hljs-keyword\">import</span> { render } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@testing-library/react&quot;</span>;\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">QueryClient</span>, <span class=\"hljs-title class_\">QueryClientProvider</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@tanstack/react-query&quot;</span>;\n<span class=\"hljs-keyword\">import</span> useBreedList <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../useBreedList&quot;</span>;\n\n<span class=\"hljs-keyword\">const</span> queryClient = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">QueryClient</span>({\n  <span class=\"hljs-attr\">defaultOptions</span>: {\n    <span class=\"hljs-attr\">queries</span>: {\n      <span class=\"hljs-attr\">staleTime</span>: <span class=\"hljs-title class_\">Infinity</span>,\n      <span class=\"hljs-attr\">cacheTime</span>: <span class=\"hljs-title class_\">Infinity</span>,\n      <span class=\"hljs-attr\">retry</span>: <span class=\"hljs-literal\">false</span>,\n    },\n  },\n});\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">getBreedList</span>(<span class=\"hljs-params\">animal</span>) {\n  <span class=\"hljs-keyword\">let</span> list;\n\n  <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">TestComponent</span>(<span class=\"hljs-params\"></span>) {\n    list = <span class=\"hljs-title function_\">useBreedList</span>(animal);\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;\n  }\n\n  <span class=\"hljs-title function_\">render</span>(\n    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">QueryClientProvider</span> <span class=\"hljs-attr\">client</span>=<span class=\"hljs-string\">{queryClient}</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">TestComponent</span> /&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">QueryClientProvider</span>&gt;</span></span>\n  );\n\n  <span class=\"hljs-keyword\">return</span> list;\n}\n\n<span class=\"hljs-title function_\">test</span>(<span class=\"hljs-string\">&quot;gives an empty list with no animal&quot;</span>, <span class=\"hljs-keyword\">async</span> () =&gt; {\n  <span class=\"hljs-keyword\">const</span> [breedList, status] = <span class=\"hljs-title function_\">getBreedList</span>();\n  <span class=\"hljs-title function_\">expect</span>(breedList).<span class=\"hljs-title function_\">toHaveLength</span>(<span class=\"hljs-number\">0</span>);\n  <span class=\"hljs-title function_\">expect</span>(status).<span class=\"hljs-title function_\">toBe</span>(<span class=\"hljs-string\">&quot;loading&quot;</span>);\n});\n</code></pre>\n<p>It&#39;s a little weird to implement a fake component to test something (we&#39;re dangerously close to the line of testing implementation details) but this is essentially library code and we want to assure ourselves this code works if we use it frequently in our code base. We also have to provide for the query provider because it relies on it being there. We&#39;re giving it a <code>retry: false</code> key-value pair because we want it to fail fast instead of retrying.</p>\n<p>We can make this better though. Let&#39;s rewrite our test to look like this:</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">import</span> { expect, test } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;vitest&quot;</span>;\n<span class=\"hljs-keyword\">import</span> { renderHook } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@testing-library/react&quot;</span>;\n<span class=\"hljs-keyword\">import</span> { <span class=\"hljs-title class_\">QueryClient</span>, <span class=\"hljs-title class_\">QueryClientProvider</span> } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;@tanstack/react-query&quot;</span>;\n<span class=\"hljs-keyword\">import</span> useBreedList <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;../useBreedList&quot;</span>;\n\n<span class=\"hljs-keyword\">const</span> queryClient = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">QueryClient</span>({\n  <span class=\"hljs-attr\">defaultOptions</span>: {\n    <span class=\"hljs-attr\">queries</span>: {\n      <span class=\"hljs-attr\">staleTime</span>: <span class=\"hljs-title class_\">Infinity</span>,\n      <span class=\"hljs-attr\">cacheTime</span>: <span class=\"hljs-title class_\">Infinity</span>,\n      <span class=\"hljs-attr\">retry</span>: <span class=\"hljs-literal\">false</span>,\n    },\n  },\n});\n\n<span class=\"hljs-title function_\">test</span>(<span class=\"hljs-string\">&quot;gives an empty list with no animal&quot;</span>, <span class=\"hljs-keyword\">async</span> () =&gt; {\n  <span class=\"hljs-keyword\">const</span> { result } = <span class=\"hljs-title function_\">renderHook</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">useBreedList</span>(<span class=\"hljs-string\">&quot;&quot;</span>), {\n    <span class=\"hljs-attr\">wrapper</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">{ children }</span>) =&gt;</span> (\n      <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">QueryClientProvider</span> <span class=\"hljs-attr\">client</span>=<span class=\"hljs-string\">{queryClient}</span>&gt;</span>{children}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">QueryClientProvider</span>&gt;</span></span>\n    ),\n  });\n\n  <span class=\"hljs-keyword\">const</span> [breedList, status] = result.<span class=\"hljs-property\">current</span>;\n\n  <span class=\"hljs-title function_\">expect</span>(breedList).<span class=\"hljs-title function_\">toHaveLength</span>(<span class=\"hljs-number\">0</span>);\n  <span class=\"hljs-title function_\">expect</span>(status).<span class=\"hljs-title function_\">toBe</span>(<span class=\"hljs-string\">&quot;loading&quot;</span>);\n});\n</code></pre>\n<p>Here the helper <code>renderHook</code> abstracts away that oddity we had to do to get that hook tested. But rest assured it&#39;s doing essentially the same thing: creating a component under the hood that&#39;s running the hook lifecycle methods appropriately for you. We do still have to give it a wrapper to appropriately give it the context it needs for react-query but that&#39;s it.</p>\n","slug":"testing-custom-hooks","title":"Testing Custom Hooks","section":"Testing","icon":"vial","filePath":"/home/runner/work/complete-intro-to-react-v8/complete-intro-to-react-v8/lessons/15-testing/D-testing-custom-hooks.md","nextSlug":"/lessons/testing/mocks","prevSlug":"/lessons/testing/testing-ui-interactions"}},"__N_SSG":true}