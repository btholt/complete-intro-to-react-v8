<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/x-icon" href="/images/favicon.ico"/><title>Deferred Values – Complete Intro to React v8</title><meta name="description" content="Come learn React from Brian Holt, a veteran React.js developer on Frontend Masters"/><meta name="og:description" content="Come learn React from Brian Holt, a veteran React.js developer on Frontend Masters"/><meta name="og:title" content="Deferred Values – Complete Intro to React v8"/><meta name="og:image" content="/images/social-share-cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="13"/><link rel="preload" href="/_next/static/css/2804460643ba240b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2804460643ba240b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-fd82975a6094609f.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-18053c3f67c4d467.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1b2d39785caff4f6.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-327376b1b9678381.js" defer=""></script><script src="/_next/static/yd4WPLujy-nCGMct90RA5/_buildManifest.js" defer=""></script><script src="/_next/static/yd4WPLujy-nCGMct90RA5/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to React v8</a></h1><div class="navbar-info"><a href="https://frontendmasters.com/courses/complete-react-v8/" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><blockquote>
<p>Please start with a fresh copy of this app: <a href="https://github.com/btholt/citr-v8-project/tree/master/14-context">Adopt Me!</a></p>
</blockquote>
<p>Like I have said before in this class, many of React&#39;s newest features are for <em>Facebook&#39;s</em> problems, not yours. When you are rendering a page like the feed of facebook.com you have a myriad of issues that normal people don&#39;t have.</p>
<ul>
<li>There many teams working on that page. Whole teams are dedicated to little widgets</li>
<li>They have data coming from everywhere.</li>
<li>There <em>a lot</em> of DOM nodes on that page. Even fast computer would struggle with a lot of trash on that page.</li>
<li>The faster the page is the more money they make. A half second of page load is literally millions of dollars to them.</li>
</ul>
<p>Most of us are not in the above bucket. But when you are, certain problems arise and Facebook needs to solve those for themselves. Transitions are one of these solutions to one of these classes of problems.</p>
<p>Imagine you&#39;re doing a re-render of a large newsfeed of information and a user clicks on one of the side widgets that opens the top menu. What would you expect to happen. If a user caught the exact moment that the big newsfeed was re-rendering, it could cause a moment of jank: two big things are happening at the exact same. For most of us that is an acceptable risk and one we wouldn&#39;t pursue to solve any further unless it was a massive issue. For Facebook, it is a big issue. Lots of stuff is rendering and users can cause their site to feel janky with their clicking. So Facebook made transitions.</p>
<p>The idea behind transitions is some of your renders are low priority: if they need to be interrupted they can be. What you don&#39;t want is to interrupt user intent: if a user clicks on a thing then you want drop everything to make sure that click felt responsive. We are going to use a hook called <code>useDeferredValue</code> to accomplish exactly this.</p>
<blockquote>
<p>We&#39;re going to code this and it&#39;s going to feel like it does nothing. Because it&#39;s essentially going to do nothing for us. <code>useDeferredValue</code> is useful when a lot of things are happening. This is a performance trick and should only be used when you actually have a performance issue.</p>
</blockquote>
<p>Right now the biggest re-render in app is when our app gets a new batch of pets to render. Imagine if we had three hundred pets to render: that actually could take a while. And if in the mean time a user clicked a button to adopt a pet or re-search for something else, we&#39;d want to drop rendering other pets and focus on what the user asked for. So let&#39;s see that.</p>
<p>Open SearchParams.jsx.</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">// replace react import</span>
<span class="hljs-keyword">import</span> { useContext, useDeferredValue, useMemo, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;

<span class="hljs-comment">// under pets declaration</span>
<span class="hljs-keyword">const</span> deferredPets = <span class="hljs-title function_">useDeferredValue</span>(pets);
<span class="hljs-keyword">const</span> renderedPets = <span class="hljs-title function_">useMemo</span>(
  <span class="hljs-function">() =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Results</span> <span class="hljs-attr">pets</span>=<span class="hljs-string">{deferredPets}</span> /&gt;</span></span>,
  [deferredPets]
);

<span class="hljs-comment">// replace &lt;Results /&gt; line</span>
{
  renderedPets;
}
</code></pre>
<ul>
<li>useDeferredValue takes in a value and gives you a cached version of it: that cached version may be current or it may a stale one as it works through a re-render. Evenutally it will be the current one</li>
<li>We then need to <em>use</em> that cached version. So we use <code>useMemo</code> to make a version of the component that can be used and won&#39;t change until the deferredPets value changes (otherwise it&#39;ll just re-render every time anyway)</li>
</ul>
<p>That&#39;s really it. The idea here is you have some part of your app that when it re-renders it causes jank in other parts of your app and it can be slowed down a bit without issue. <code>useDeferredValue</code> is exactly for that.</p>
</div><div class="lesson-links"><a href="/lessons/advance-react-performance/server-side-rendering" class="prev">← Previous</a><a href="/lessons/low-priority-rerendering/transitions" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="40" height="32" viewBox="0 0 40 32"><defs><clipPath id="clip-twitter-social"><rect width="40" height="32"></rect></clipPath></defs><g id="twitter-social" clip-path="url(#clip-twitter-social)"><g id="Group_269" data-name="Group 269" transform="translate(-230.23 -1140.849)"><path id="Path_419" data-name="Path 419" d="M266.12,1148.861v1.035a23.092,23.092,0,0,1-1.507,8.1,24.08,24.08,0,0,1-4.475,7.381,22.175,22.175,0,0,1-7.306,5.4,24.129,24.129,0,0,1-10,2.07,23.7,23.7,0,0,1-6.667-.945,22.83,22.83,0,0,1-5.936-2.655q.959.091,1.963.09a16.518,16.518,0,0,0,5.434-.9,17.111,17.111,0,0,0,4.749-2.52,8.275,8.275,0,0,1-4.749-1.643,7.8,7.8,0,0,1-2.877-3.983,8.268,8.268,0,0,0,1.507.135,8.58,8.58,0,0,0,2.146-.27,8.16,8.16,0,0,1-5.685-4.344,8.326,8.326,0,0,1-.89-3.578v-.135a7.775,7.775,0,0,0,3.744,1.035,8.183,8.183,0,0,1-2.671-2.9,7.817,7.817,0,0,1-.982-3.848,7.948,7.948,0,0,1,1.1-4.05,23.53,23.53,0,0,0,16.895,8.46,9.221,9.221,0,0,1-.183-1.845,7.787,7.787,0,0,1,1.1-4.05,8.216,8.216,0,0,1,2.991-2.948,7.991,7.991,0,0,1,4.087-1.1,8.184,8.184,0,0,1,5.982,2.566,16.087,16.087,0,0,0,5.205-1.98,7.784,7.784,0,0,1-1.393,2.588,8.4,8.4,0,0,1-2.215,1.913,16.856,16.856,0,0,0,4.749-1.305A17.032,17.032,0,0,1,266.12,1148.861Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Excercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"description":""},"html":"\u003cblockquote\u003e\n\u003cp\u003ePlease start with a fresh copy of this app: \u003ca href=\"https://github.com/btholt/citr-v8-project/tree/master/14-context\"\u003eAdopt Me!\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eLike I have said before in this class, many of React\u0026#39;s newest features are for \u003cem\u003eFacebook\u0026#39;s\u003c/em\u003e problems, not yours. When you are rendering a page like the feed of facebook.com you have a myriad of issues that normal people don\u0026#39;t have.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThere many teams working on that page. Whole teams are dedicated to little widgets\u003c/li\u003e\n\u003cli\u003eThey have data coming from everywhere.\u003c/li\u003e\n\u003cli\u003eThere \u003cem\u003ea lot\u003c/em\u003e of DOM nodes on that page. Even fast computer would struggle with a lot of trash on that page.\u003c/li\u003e\n\u003cli\u003eThe faster the page is the more money they make. A half second of page load is literally millions of dollars to them.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eMost of us are not in the above bucket. But when you are, certain problems arise and Facebook needs to solve those for themselves. Transitions are one of these solutions to one of these classes of problems.\u003c/p\u003e\n\u003cp\u003eImagine you\u0026#39;re doing a re-render of a large newsfeed of information and a user clicks on one of the side widgets that opens the top menu. What would you expect to happen. If a user caught the exact moment that the big newsfeed was re-rendering, it could cause a moment of jank: two big things are happening at the exact same. For most of us that is an acceptable risk and one we wouldn\u0026#39;t pursue to solve any further unless it was a massive issue. For Facebook, it is a big issue. Lots of stuff is rendering and users can cause their site to feel janky with their clicking. So Facebook made transitions.\u003c/p\u003e\n\u003cp\u003eThe idea behind transitions is some of your renders are low priority: if they need to be interrupted they can be. What you don\u0026#39;t want is to interrupt user intent: if a user clicks on a thing then you want drop everything to make sure that click felt responsive. We are going to use a hook called \u003ccode\u003euseDeferredValue\u003c/code\u003e to accomplish exactly this.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWe\u0026#39;re going to code this and it\u0026#39;s going to feel like it does nothing. Because it\u0026#39;s essentially going to do nothing for us. \u003ccode\u003euseDeferredValue\u003c/code\u003e is useful when a lot of things are happening. This is a performance trick and should only be used when you actually have a performance issue.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eRight now the biggest re-render in app is when our app gets a new batch of pets to render. Imagine if we had three hundred pets to render: that actually could take a while. And if in the mean time a user clicked a button to adopt a pet or re-search for something else, we\u0026#39;d want to drop rendering other pets and focus on what the user asked for. So let\u0026#39;s see that.\u003c/p\u003e\n\u003cp\u003eOpen SearchParams.jsx.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-comment\"\u003e// replace react import\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { useContext, useDeferredValue, useMemo, useState } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// under pets declaration\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e deferredPets = \u003cspan class=\"hljs-title function_\"\u003euseDeferredValue\u003c/span\u003e(pets);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e renderedPets = \u003cspan class=\"hljs-title function_\"\u003euseMemo\u003c/span\u003e(\n  \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eResults\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003epets\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{deferredPets}\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e,\n  [deferredPets]\n);\n\n\u003cspan class=\"hljs-comment\"\u003e// replace \u0026lt;Results /\u0026gt; line\u003c/span\u003e\n{\n  renderedPets;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003euseDeferredValue takes in a value and gives you a cached version of it: that cached version may be current or it may a stale one as it works through a re-render. Evenutally it will be the current one\u003c/li\u003e\n\u003cli\u003eWe then need to \u003cem\u003euse\u003c/em\u003e that cached version. So we use \u003ccode\u003euseMemo\u003c/code\u003e to make a version of the component that can be used and won\u0026#39;t change until the deferredPets value changes (otherwise it\u0026#39;ll just re-render every time anyway)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThat\u0026#39;s really it. The idea here is you have some part of your app that when it re-renders it causes jank in other parts of your app and it can be slowed down a bit without issue. \u003ccode\u003euseDeferredValue\u003c/code\u003e is exactly for that.\u003c/p\u003e\n","slug":"deferred-values","title":"Deferred Values","section":"Low Priority Rerendering","icon":"sliders-h","filePath":"/home/runner/work/complete-intro-to-react-v8/complete-intro-to-react-v8/lessons/12-low-priority-rerendering/A-deferred-values.md","nextSlug":"/lessons/low-priority-rerendering/transitions","prevSlug":"/lessons/advance-react-performance/server-side-rendering"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"low-priority-rerendering","slug":"deferred-values"},"buildId":"yd4WPLujy-nCGMct90RA5","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>